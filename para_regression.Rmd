---
title: "para_regression"
output: html_document
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(here)
library(tidyverse)
library(magrittr)
```


```{r}
host_para_mat <- readRDS(here("data", "processed_data", "para_mat.rds"))
ecoreg_host_mat <- readRDS(here("data", "processed_data", "ecoreg_mat.rds"))
ecoreg_para_mat <- readRDS(here("data", "processed_data", "ecoreg_para_mat.rds"))
null_para_df <- readRDS(here("data", "processed_data", "null_para_df.rds"))
```


```{r}
null_proportion = 0.05
```



```{r}
null_para_df %<>% group_by(sci_name, para) %>% slice_sample(prop = null_proportion) %>% ungroup()
```



```{r}
null_para_mat <- null_para_df %>% 
  dplyr::select(c(para, name, value)) %>% 
  distinct() %>% 
  pivot_wider(., names_from = name, values_from = value) %>%
  replace(is.na(.), 0)
```


Null regression

100% coverage
```{r}
host_rich <- colSums(ecoreg_host_mat[2:ncol(ecoreg_host_mat)])
null_para_rich <- colSums(null_para_mat[2:ncol(null_para_mat)])
para_rich <- colSums(ecoreg_para_mat[2:ncol(ecoreg_para_mat)])
```

```{r}
tmp <- tibble(para = null_para_rich, ecoreg = names(null_para_rich))

null_rich_df <- tibble(ecoreg = names(host_rich), host = host_rich)

null_rich_df %<>% left_join(., tmp)

null_rich_df %<>% replace(is.na(.), 0)
```

```{r}
null_rich_df %>% filter(para>0) %>% ggplot(.,aes(x=host, y=para)) + geom_point() + geom_smooth(method="lm")

summary(lm(para ~ host, data = null_rich_df))
```




Actual regression

```{r}
host_rich <- colSums(ecoreg_host_mat[2:717])
```

```{r}
tmp <- tibble(para = para_rich, ecoreg = names(para_rich))

rich_df <- tibble(ecoreg = names(host_rich), host = host_rich)

rich_df %<>% left_join(., tmp)

rich_df %<>% replace(is.na(.), 0)
```

```{r}
rich_df %>% filter(para>0) %>% ggplot(.,aes(x=host, y=para)) + geom_point() + geom_smooth(method="lm")

summary(lm(para ~ host, data = rich_df))
```